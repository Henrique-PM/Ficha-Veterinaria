<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de {{animal.name}} - VetCare</title>
    <link rel="stylesheet" href="/css/minimal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="sidebar">
        <div class="logo">üêæ VetCare</div>
        <ul class="nav">
            <li><a href="/vet/dashboard"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
            <li><a href="/vet/biblioteca"><i class="fas fa-image"></i><span>Biblioteca</span></a></li>
            <li><a href="/vet/consultas"><i class="fas fa-stethoscope"></i><span>Consultas</span></a></li>
            <li><a href="/vet/medicamentos"><i class="fas fa-pills"></i><span>Medicamentos</span></a></li>
            <li><a href="/vet/relatorios"><i class="fas fa-chart-line"></i><span>Relat√≥rios</span></a></li>
            <li style="margin-top: auto;"><a href="/auth/logout"><i class="fas fa-sign-out-alt"></i><span>Sair</span></a></li>
        </ul>
    </nav>

    <div class="main">
        <div class="topbar">
            <div style="display: flex; gap: 15px; align-items: center;">
                <a href="/vet/dashboard" class="btn btn-primary btn-sm">‚Üê Voltar</a>
                <h1 style="margin: 0;">{{animal.name}}</h1>
                <form action="/vet/animal/{{animal.id}}/status" method="POST" style="display: flex; gap: 10px; align-items: center;">
                    <select id="statusSelect" name="status" class="form-control" style="width: 150px; padding: 6px 10px;">
                        <option value="abrigo">Abrigo</option>
                        <option value="hospital">Hospital</option>
                        <option value="clinica">Cl√≠nica</option>
                        <option value="adotado">Adotado</option>
                        <option value="falecido">Falecido</option>
                    </select>
                    <button type="submit" class="btn btn-success btn-sm">Atualizar</button>
                </form>
            </div>
        </div>
        <script>
            document.getElementById('statusSelect').value = '{{animal.status}}';
            const sexEl = document.getElementById('sexSelect');
            if (sexEl) sexEl.value = '{{animal.sex}}';
        </script>

        <!-- Info Principal -->
        <div class="shell">
            <div style="display: grid; grid-template-columns: 260px 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <div class="animal-img" style="background-image: url('/animal/photo/{{animal.id}}'); height: 240px; margin-bottom: 15px;"></div>
                    <form action="/vet/animal/{{animal.id}}/photo" method="POST" enctype="multipart/form-data" style="display:flex; gap:10px; align-items:center;">
                        <input type="file" name="photo" accept="image/*" class="form-control" required>
                        <button type="submit" class="btn btn-primary btn-sm">Alterar foto</button>
                    </form>
                </div>
                <div>
                    <div class="card">
                        <h3>Informa√ß√µes B√°sicas</h3>
                        <form method="POST" action="/vet/animal/{{animal.id}}/info" style="display: grid; gap: 12px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div>
                                    <label class="form-label">Nome *</label>
                                    <input type="text" name="name" class="form-control" value="{{animal.name}}" required>
                                </div>
                                <div>
                                    <label class="form-label">Esp√©cie *</label>
                                    <input type="text" name="species" class="form-control" value="{{animal.species}}" required>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div>
                                    <label class="form-label">Ra√ßa</label>
                                    <input type="text" name="breed" class="form-control" value="{{animal.breed}}">
                                </div>
                                <div>
                                    <label class="form-label">N√∫mero do chip</label>
                                    <input type="text" name="chip_number" class="form-control" value="{{animal.chip_number}}">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div>
                                    <label class="form-label">Idade (anos)</label>
                                    <input type="number" name="age" class="form-control" value="{{animal.age}}" min="0">
                                </div>
                                <div>
                                    <label class="form-label">Sexo</label>
                                    <select id="sexSelect" name="sex" class="form-control">
                                        <option value="">Selecione...</option>
                                        <option value="macho">Macho</option>
                                        <option value="f√™mea">F√™mea</option>
                                        <option value="indeterminado">Indeterminado</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Descri√ß√£o</label>
                                <textarea name="description" class="form-control" style="min-height: 70px;">{{animal.description}}</textarea>
                            </div>
                            <div>
                                <label class="form-label">Caracter√≠sticas</label>
                                <textarea name="characteristics" class="form-control" style="min-height: 70px;">{{animal.characteristics}}</textarea>
                            </div>
                            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 4px;">
                                <button type="submit" class="btn btn-success btn-sm">Salvar altera√ß√µes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Galeria de Fotos (somente visualiza√ß√£o) -->
        <div class="card">
            <h3><i class="fas fa-images"></i> Fotos do Animal</h3>
            {{#if photos.length}}
            <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                {{#each photos}}
                <div class="animal-card">
                    <div class="animal-img" style="background-image: url('/animal/photo-extra/{{this.id}}'); height: 160px;"></div>
                    <div class="animal-info" style="padding: 10px;">
                        <div class="animal-name" style="font-size: 0.95rem;">{{this.description}}</div>
                        <div class="animal-tags">
                            <span class="tag">{{this.upload_date}}</span>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
            {{else}}
            <p class="empty">Nenhuma foto adicional</p>
            {{/if}}
        </div>

        <!-- Abas de Conte√∫do -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
            <button onclick="switchTab('health')" id="tab-health" class="btn btn-primary btn-sm" style="border: none; background: transparent; color: var(--primary); border-bottom: 2px solid var(--primary); padding: 10px 0;">
                Sa√∫de
            </button>
            <button onclick="switchTab('vaccines')" id="tab-vaccines" class="btn btn-primary btn-sm" style="border: none; background: transparent; color: var(--muted); padding: 10px 0;">
                Vacina√ß√£o
            </button>
            <button onclick="switchTab('procedures')" id="tab-procedures" class="btn btn-primary btn-sm" style="border: none; background: transparent; color: var(--muted); padding: 10px 0;">
                Procedimentos
            </button>
            <button onclick="switchTab('hospitalizations')" id="tab-hospitalizations" class="btn btn-primary btn-sm" style="border: none; background: transparent; color: var(--muted); padding: 10px 0;">
                Interna√ß√µes
            </button>
        </div>

        <!-- Tab: Sa√∫de -->
        <div id="content-health" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Hist√≥rico de Sa√∫de</h3>
                    <button onclick="openModal('health')" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                {{#if healthRecords.length}}
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Peso (kg)</th>
                            <th>Condi√ß√£o Corporal</th>
                            <th>Alergias</th>
                            <th>Observa√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each healthRecords}}
                        <tr>
                            <td>{{this.updated_at}}</td>
                            <td>{{this.weight}}</td>
                            <td>{{this.body_condition}}</td>
                            <td>{{this.allergies}}</td>
                            <td>{{this.observations}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{else}}
                <p class="empty">Nenhum registro de sa√∫de</p>
                {{/if}}
            </div>
        </div>

        <!-- Tab: Vacina√ß√£o -->
        <div id="content-vaccines" class="tab-content" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Hist√≥rico de Vacina√ß√£o</h3>
                    <button onclick="openModal('vaccine')" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                {{#if vaccines.length}}
                <table>
                    <thead>
                        <tr>
                            <th>Vacina</th>
                            <th>Data</th>
                            <th>Pr√≥xima Dose</th>
                            <th>Lote</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each vaccines}}
                        <tr>
                            <td><strong>{{this.name}}</strong></td>
                            <td>{{this.application_date}}</td>
                            <td>{{this.next_dose}}</td>
                            <td>{{this.batch}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{else}}
                <p class="empty">Nenhuma vacina√ß√£o registrada</p>
                {{/if}}
            </div>
        </div>

        <!-- Tab: Procedimentos -->
        <div id="content-procedures" class="tab-content" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Procedimentos Realizados</h3>
                    <button onclick="openModal('procedure')" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                {{#if procedures.length}}
                <table>
                    <thead>
                        <tr>
                            <th>Procedimento</th>
                            <th>Data</th>
                            <th>Resultado</th>
                            <th>Veterin√°rio</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each procedures}}
                        <tr>
                            <td><strong>{{this.name}}</strong></td>
                            <td>{{this.procedure_date}}</td>
                            <td>{{this.description}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{else}}
                <p class="empty">Nenhum procedimento registrado</p>
                {{/if}}
            </div>
        </div>

        <!-- Tab: Interna√ß√µes -->
        <div id="content-hospitalizations" class="tab-content" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Hist√≥rico de Interna√ß√µes</h3>
                    <button onclick="openModal('hospitalization')" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                {{#if hospitalizations.length}}
                <table>
                    <thead>
                        <tr>
                            <th>Data Entrada</th>
                            <th>Motivo</th>
                            <th>Diagn√≥stico</th>
                            <th>Tratamento</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each hospitalizations}}
                        <tr>
                            <td>{{this.entry_date}}</td>
                            <td>{{this.reason}}</td>
                            <td>{{this.diagnosis}}</td>
                            <td>{{this.treatment}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{else}}
                <p class="empty">Nenhuma interna√ß√£o registrada</p>
                {{/if}}
            </div>
        </div>

        <!-- Se√ß√£o Geral: Medicamentos -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>Medicamentos Prescritos</h3>
                <button onclick="openModal('medication')" class="btn btn-success btn-sm">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            {{#if medications.length}}
            <div style="display: grid; gap: 10px;">
                {{#each medications}}
                <div style="background: var(--bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>{{this.medication_name}}</strong><br>
                            <small style="color: var(--muted);">Dosagem: {{this.dosage}} | Frequ√™ncia: {{this.frequency}}</small><br>
                            <small style="color: var(--muted);">De {{this.start_date}} at√© {{this.end_date}}</small>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
            {{else}}
            <p class="empty">Nenhum medicamento prescrito</p>
            {{/if}}
        </div>

        <!-- Se√ß√£o Geral: Documentos -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>Documentos</h3>
                <button onclick="openModal('document')" class="btn btn-success btn-sm">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            {{#if documents.length}}
            <div style="display: grid; gap: 10px;">
                {{#each documents}}
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg); border-radius: 8px; border: 1px solid var(--border);">
                    <div>
                        <i class="fas fa-file"></i> {{this.description}}<br>
                        <small style="color: var(--muted);">Enviado em {{this.upload_date}}</small>
                    </div>
                    <a href="/animal/document/{{this.id}}" class="btn btn-primary btn-sm">
                        <i class="fas fa-download"></i> Download
                    </a>
                </div>
                {{/each}}
            </div>
            {{else}}
            <p class="empty">Nenhum documento</p>
            {{/if}}
        </div>
    </div>

    <!-- Modais -->
    <!-- Modal: Adicionar Sa√∫de -->
    <div id="modal-health" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Atualizar Sa√∫de</h2>
                <button class="close" onclick="closeModal('health')">&times;</button>
            </div>
            <form id="form-health" method="POST" action="/vet/animal/{{animal.id}}/health-record">
                <div class="form-group">
                    <label class="form-label">Peso (kg)</label>
                    <input type="number" step="0.1" name="weight" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Condi√ß√£o Corporal</label>
                    <select name="body_condition" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="Muito magro">Muito magro</option>
                        <option value="Magro">Magro</option>
                        <option value="Ideal">Ideal</option>
                        <option value="Acima do peso">Acima do peso</option>
                        <option value="Obeso">Obeso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Alergias</label>
                    <input type="text" name="allergies" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea name="observations" class="form-control" style="min-height: 100px;"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-full">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Vacina√ß√£o -->
    <div id="modal-vaccine" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrar Vacina√ß√£o</h2>
                <button class="close" onclick="closeModal('vaccine')">&times;</button>
            </div>
            <form id="form-vaccine" method="POST" action="/vet/animal/{{animal.id}}/vaccine">
                <div class="form-group">
                    <label class="form-label">Vacina *</label>
                    <input type="text" name="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data Aplica√ß√£o *</label>
                    <input type="date" name="application_date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Pr√≥xima Dose</label>
                    <input type="date" name="next_dose" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Lote</label>
                    <input type="text" name="batch" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea name="observations" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-full">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Procedimento -->
    <div id="modal-procedure" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrar Procedimento</h2>
                <button class="close" onclick="closeModal('procedure')">&times;</button>
            </div>
            <form id="form-procedure" method="POST" action="/vet/animal/{{animal.id}}/procedure">
                <div class="form-group">
                    <label class="form-label">Nome *</label>
                    <input type="text" name="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data *</label>
                    <input type="date" name="procedure_date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea name="description" class="form-control" style="min-height: 100px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea name="observations" class="form-control" style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-full">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Medicamento -->
    <div id="modal-medication" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Prescrever Medicamento</h2>
                <button class="close" onclick="closeModal('medication')">&times;</button>
            </div>
            <form id="form-medication" method="POST" action="/vet/animal/{{animal.id}}/receita">
                <div class="form-group">
                    <label class="form-label">Medicamento *</label>
                    <input type="text" name="medication_name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Dosagem *</label>
                    <input type="text" name="dosage" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Frequ√™ncia *</label>
                    <input type="text" name="frequency" class="form-control" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Data In√≠cio *</label>
                        <input type="date" name="start_date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data Fim</label>
                        <input type="date" name="end_date" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea name="notes" class="form-control" style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-full">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Interna√ß√£o -->
    <div id="modal-hospitalization" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrar Interna√ß√£o</h2>
                <button class="close" onclick="closeModal('hospitalization')">&times;</button>
            </div>
            <form id="form-hospitalization" method="POST" action="/vet/animal/{{animal.id}}/hospitalization">
                <div class="form-group">
                    <label class="form-label">Data Entrada *</label>
                    <input type="date" name="entry_date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Motivo *</label>
                    <input type="text" name="reason" class="form-control" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Diagn√≥stico</label>
                        <textarea name="diagnosis" class="form-control" style="min-height: 80px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tratamento</label>
                        <textarea name="treatment" class="form-control" style="min-height: 80px;"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Procedimentos Realizados</label>
                    <textarea name="procedures" class="form-control" style="min-height: 80px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea name="observations" class="form-control" style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn btn-success w-full">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Documento -->
    <div id="modal-document" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Anexar Documento</h2>
                <button class="close" onclick="closeModal('document')">&times;</button>
            </div>
            <form id="form-document" method="POST" action="/vet/animal/{{animal.id}}/document" enctype="multipart/form-data">
                <div class="form-group">
                    <label class="form-label">Arquivo *</label>
                    <input type="file" name="document" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" name="description" class="form-control" placeholder="Ex: Raio-X, Exame de Sangue...">
                </div>
                <button type="submit" class="btn btn-success w-full">Enviar</button>
            </form>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.style.color = 'var(--muted)';
                el.style.borderBottom = 'none';
            });
            
            // Show selected tab
            document.getElementById('content-' + tabName).style.display = 'block';
            document.getElementById('tab-' + tabName).style.color = 'var(--primary)';
            document.getElementById('tab-' + tabName).style.borderBottom = '2px solid var(--primary)';
        }

        function openModal(type) {
            document.getElementById('modal-' + type).style.display = 'block';
        }

        function closeModal(type) {
            document.getElementById('modal-' + type).style.display = 'none';
        }

        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
