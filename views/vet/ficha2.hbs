<style>
  :root {
    --bg: #0f1115;
    --card: #171a21;
    --muted: #9ea7b3;
    --text: #e6e8ec;
    --primary: #5aa4ff;
    --primary-2: #3c7fd9;
    --border: #252a32;
    --danger: #f05d5e;
    --success: #34c38f;
    --warning: #f6c343;
  }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; }
  a { color: var(--primary); text-decoration: none; }
  .shell { max-width: 1180px; margin: 0 auto; padding: 24px 16px; }
  .top { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:18px; }
  .pill { background: var(--card); padding: 8px 12px; border-radius: 8px; border:1px solid var(--border); color: var(--muted); }
  .card { background: var(--card); border:1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom:16px; }
  .flex { display:flex; gap:16px; }
  .photo { width:260px; min-height:240px; border-radius: 12px; background:#0b0d11 center/cover no-repeat; border:1px solid var(--border); }
  .grid2 { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; margin: 12px 0; }
  .tag { padding:4px 10px; border-radius: 12px; background:#1f2430; color: var(--muted); display:inline-block; }
  table { width:100%; border-collapse:collapse; }
  th,td { padding:10px; border-bottom:1px solid var(--border); text-align:left; }
  th { color: var(--muted); font-size:0.9rem; }
  .btn { display:inline-block; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600; color:#fff; background:var(--primary); }
  .btn:hover { background: var(--primary-2); }
  .btn-ghost { background: transparent; border:1px solid var(--border); color: var(--text); }
  .btn-danger { background: var(--danger); }
  form .row { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; }
  label { display:block; margin-bottom:6px; color: var(--muted); font-size:0.9rem; }
  input, select, textarea { width:100%; background:#10131a; color: var(--text); border:1px solid var(--border); border-radius:8px; padding:10px; }
  textarea { min-height:110px; resize:vertical; }
  .section-title { display:flex; align-items:center; gap:8px; margin:0 0 8px; color: var(--text); }
  .empty { color: var(--muted); padding:8px 0; }
  @media(max-width:780px){ .flex{flex-direction:column;} .photo{width:100%;} }
</style>

<div class="shell">
  <div class="top">
    <div style="display:flex;gap:10px;align-items:center;">
      <a href="/vet/dashboard" class="pill">← Voltar</a>
      <span class="pill">{{animal.status}}</span>
    </div>
    <a href="/auth/logout" class="pill">Sair</a>
  </div>

  <div class="card flex">
    <div class="photo" style="background-image:url('/animal/photo/{{animal.id}}');"></div>
    <div style="flex:1;">
      <h2 style="margin:0 0 8px;">{{animal.name}}</h2>
      <div class="grid2">
        <div><span class="tag">Espécie</span><div>{{animal.species}}</div></div>
        <div><span class="tag">Raça</span><div>{{animal.breed}}</div></div>
        <div><span class="tag">Idade</span><div>{{animal.age}} anos</div></div>
        <div><span class="tag">Sexo</span><div>{{animal.sex}}</div></div>
        <div><span class="tag">Status</span><div>{{animal.status}}</div></div>
        <div><span class="tag">Entrada</span><div>{{animal.entry_date}}</div></div>
        <div><span class="tag">Chip</span><div>{{animal.chip_number}}</div></div>
        <div><span class="tag">Criado por</span><div>{{animal.created_by}}</div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="section-title"><span>Saúde atual</span></div>
    {{#if healthRecord}}
      <div class="grid2">
        <div><span class="tag">Peso</span><div>{{healthRecord.weight}} kg</div></div>
        <div><span class="tag">Condição</span><div>{{healthRecord.body_condition}}</div></div>
        <div><span class="tag">Alergias</span><div>{{healthRecord.allergies}}</div></div>
        <div><span class="tag">Atualizado</span><div>{{healthRecord.updated_at}}</div></div>
      </div>
      <div><span class="tag">Observações</span><div>{{healthRecord.observations}}</div></div>
    {{else}}
      <div class="empty">Nenhum registro de saúde ainda.</div>
    {{/if}}
  </div>

  <div class="card">
    <div class="section-title">Vacinas</div>
    {{#if vaccines.length}}
      <table>
        <thead><tr><th>Nome</th><th>Aplicação</th><th>Próxima dose</th><th>Lote</th><th>Vet</th></tr></thead>
        <tbody>
          {{#each vaccines}}
            <tr>
              <td>{{this.name}}</td>
              <td>{{this.application_date}}</td>
              <td>{{this.next_dose}}</td>
              <td>{{this.batch}}</td>
              <td>{{this.veterinarian_id}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="empty">Nenhuma vacina registrada.</div>
    {{/if}}
  </div>

  <div class="card">
    <div class="section-title">Internações</div>
    {{#if hospitalizations.length}}
      <table>
        <thead><tr><th>Entrada</th><th>Motivo</th><th>Diagnóstico</th><th>Tratamento</th></tr></thead>
        <tbody>
          {{#each hospitalizations}}
            <tr>
              <td>{{this.entry_date}}</td>
              <td>{{this.reason}}</td>
              <td>{{this.diagnosis}}</td>
              <td>{{this.treatment}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="empty">Nenhuma internação registrada.</div>
    {{/if}}
  </div>

  <div class="card">
    <div class="section-title">Exames / Procedimentos</div>
    {{#if procedures.length}}
      <table>
        <thead><tr><th>Data</th><th>Nome</th><th>Descrição</th><th>Observações</th></tr></thead>
        <tbody>
          {{#each procedures}}
            <tr>
              <td>{{this.procedure_date}}</td>
              <td>{{this.name}}</td>
              <td>{{this.description}}</td>
              <td>{{this.observations}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="empty">Nenhum exame/procedimento registrado.</div>
    {{/if}}
  </div>

  <div class="card">
    <div class="section-title">Documentos</div>
    {{#if documents.length}}
      <table>
        <thead><tr><th>Nome</th><th>Descrição</th><th>Data</th><th>Ações</th></tr></thead>
        <tbody>
          {{#each documents}}
            <tr>
              <td>{{this.filename}}</td>
              <td>{{this.description}}</td>
              <td>{{this.upload_date}}</td>
              <td><a class="btn btn-ghost" href="/vet/animal/{{../animal.id}}/document/{{this.id}}">Baixar</a></td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="empty">Nenhum documento anexado.</div>
    {{/if}}
  </div>

  <div class="card">
    <div class="section-title">Atualizar saúde</div>
    <form method="POST" action="/vet/animal/{{animal.id}}/health-record">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <div class="row">
        <div>
          <label>Peso (kg)</label>
          <input type="number" step="0.1" name="weight">
        </div>
        <div>
          <label>Condição corporal</label>
          <select name="body_condition">
            <option value="">Selecione...</option>
            <option value="Muito magro">Muito magro</option>
            <option value="Magro">Magro</option>
            <option value="Ideal">Ideal</option>
            <option value="Acima do peso">Acima do peso</option>
            <option value="Obeso">Obeso</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Alergias</label>
          <input name="allergies">
        </div>
        <div>
          <label>Observações</label>
          <textarea name="observations"></textarea>
        </div>
      </div>
      <button class="btn" type="submit">Salvar</button>
    </form>
  </div>

  <div class="card">
    <div class="section-title">Registrar vacina</div>
    <form method="POST" action="/vet/animal/{{animal.id}}/vaccine">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <div class="row">
        <div>
          <label>Vacina</label>
          <input name="name" required>
        </div>
        <div>
          <label>Data aplicação</label>
          <input type="date" name="application_date" required>
        </div>
        <div>
          <label>Próxima dose</label>
          <input type="date" name="next_dose">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Lote</label>
          <input name="batch">
        </div>
        <div>
          <label>Observações</label>
          <textarea name="observations"></textarea>
        </div>
      </div>
      <button class="btn" type="submit">Salvar vacina</button>
    </form>
  </div>

  <div class="card">
    <div class="section-title">Registrar exame/procedimento</div>
    <form method="POST" action="/vet/animal/{{animal.id}}/procedure">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <div class="row">
        <div>
          <label>Nome</label>
          <input name="name" required>
        </div>
        <div>
          <label>Data</label>
          <input type="date" name="procedure_date" required>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Descrição</label>
          <textarea name="description"></textarea>
        </div>
        <div>
          <label>Observações</label>
          <textarea name="observations"></textarea>
        </div>
      </div>
      <button class="btn" type="submit">Salvar procedimento</button>
    </form>
  </div>

  <div class="card">
    <div class="section-title">Anexar documento</div>
    <form method="POST" action="/vet/animal/{{animal.id}}/document" enctype="multipart/form-data">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <div class="row">
        <div>
          <label>Arquivo</label>
          <input type="file" name="document" required>
        </div>
        <div>
          <label>Descrição</label>
          <input name="description" placeholder="Raio-X, exame lab...">
        </div>
      </div>
      <button class="btn" type="submit">Enviar documento</button>
    </form>
  </div>
</div>

<script>
  document.querySelectorAll('form').forEach(f=>{
    f.addEventListener('submit',e=>{
      const req = f.querySelectorAll('[required]');
      let ok=true;req.forEach(el=>{if(!el.value.trim()){el.style.borderColor='#f05d5e';ok=false;}else{el.style.borderColor='';}});
      if(!ok){e.preventDefault();alert('Preencha os campos obrigatórios.');}
    });
  });
</script>
